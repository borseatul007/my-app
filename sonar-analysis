node {
    // demo
    stage('SCM Checkout') {
        git 'https://github.com/borseatul007/my-app'
    }
    
    stage('Install Node.js') {
        // Install nvm
        sh 'curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash'
        
        // Activate nvm
        sh 'export NVM_DIR="$HOME/.nvm"'
        sh '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"'
        sh '[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"'
        
        // Install Node.js
        sh 'nvm install --lts'
        
        // Set the installed Node.js version as the default
        sh 'nvm alias default lts/*'
        
        // Verify Node.js installation
        sh 'node --version'
        sh 'npm --version'
    }
    
    stage('Build') {
        sh 'npm run build'
    }
    
   stage('SonarQube analysis') {
    def scannerHome = tool 'SonarScanner 4.0';
    withSonarQubeEnv('My SonarQube Server') { // If you have configured more than one global server connection, you can specify its name
      sh "${scannerHome}/bin/sonar-scanner"
    }
  }
    
    stage('Email Notification') {
        mail bcc: '',
            body: '''Hi Welcome to Jenkins email alerts
                    Thanks
                    Hari''',
            cc: '',
            from: '',
            replyTo: '',
            subject: 'Jenkins Job',
            to: 'borseatul007@gmail.com'
    }
    
    stage('Slack Notification') {
        slackSend baseUrl: 'https://hooks.slack.com/services/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',
            channel: '#jenkins-pipeline-demo',
            color: 'good',
            message: 'Welcome to Jenkins, Slack!',
            teamDomain: 'javahomecloud',
            tokenCredentialId: 'slack-demo'
    }
}
